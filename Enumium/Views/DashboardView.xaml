<UserControl x:Class="Enumium.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:Enumium.Helpers">

    <UserControl.Resources>
        <helpers:DoubleToPercentConverter x:Key="PctConv"/>
        <helpers:PercentToColorConverter x:Key="PctColorConv"/>
        <helpers:BoolToVisibilityConverter x:Key="BoolVis"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="28,24">
        <StackPanel>
            <!-- PAGE HEADER -->
            <Grid Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="{Binding TitleText}" Style="{StaticResource PageTitleStyle}"/>
                    <TextBlock Text="{Binding StatusText}" Style="{StaticResource BodyTextStyle}" Margin="0,4,0,0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="âš™ï¸ " FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ProcessCount}" Foreground="{StaticResource TextPrimaryBrush}"
                               FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,16,0"/>
                    <TextBlock Text="â±ï¸ " FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Uptime}" Foreground="{StaticResource TextPrimaryBrush}"
                               FontWeight="SemiBold" FontFamily="{StaticResource MonoFont}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- HEALTH SCORE + SYSTEM METRICS ROW -->
            <Grid Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Health Score Circle -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="20">
                    <StackPanel HorizontalAlignment="Center">
                        <Grid Width="120" Height="120" Margin="0,0,0,12">
                            <Ellipse Width="120" Height="120" Stroke="{StaticResource SurfaceLightBrush}" StrokeThickness="8"/>
                            <Ellipse Width="120" Height="120" StrokeThickness="8"
                                     Stroke="{Binding HealthScore, Converter={StaticResource PctColorConv}}"
                                     StrokeDashCap="Round" RenderTransformOrigin="0.5,0.5">
                                <Ellipse.RenderTransform>
                                    <RotateTransform Angle="-90"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock FontSize="32" FontWeight="Bold"
                                           Foreground="{Binding HealthScore, Converter={StaticResource PctColorConv}}"
                                           HorizontalAlignment="Center">
                                    <TextBlock.Text>
                                        <Binding Path="HealthScore" StringFormat="{}{0:F0}"/>
                                    </TextBlock.Text>
                                </TextBlock>
                                <TextBlock Text="{Binding HealthText}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                        <TextBlock Text="{Binding StatusText}" FontSize="11" TextAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- System Metrics Cards -->
                <UniformGrid Grid.Column="2" Columns="3" Rows="1">
                    <!-- CPU -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,8,0">
                        <StackPanel>
                            <Grid Margin="0,0,0,12">
                                <TextBlock Text="CPU" Style="{StaticResource SectionTitleStyle}"/>
                                <TextBlock Text="{Binding CpuUsage, Converter={StaticResource PctConv}}"
                                           HorizontalAlignment="Right" FontSize="20" FontWeight="Bold"
                                           Foreground="{Binding CpuUsage, Converter={StaticResource PctColorConv}}"/>
                            </Grid>
                            <ProgressBar Value="{Binding CpuUsage}" Maximum="100" Height="8" Margin="0,0,0,8"
                                         Style="{StaticResource AccentProgressBarStyle}"/>
                            <TextBlock Text="{Binding CpuName}" Style="{StaticResource SmallTextStyle}" TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                    </Border>

                    <!-- RAM -->
                    <Border Style="{StaticResource CardStyle}" Margin="4,0,4,0">
                        <StackPanel>
                            <Grid Margin="0,0,0,12">
                                <TextBlock Text="RAM" Style="{StaticResource SectionTitleStyle}"/>
                                <TextBlock Text="{Binding RamUsage, Converter={StaticResource PctConv}}"
                                           HorizontalAlignment="Right" FontSize="20" FontWeight="Bold"
                                           Foreground="{Binding RamUsage, Converter={StaticResource PctColorConv}}"/>
                            </Grid>
                            <ProgressBar Value="{Binding RamUsage}" Maximum="100" Height="8" Margin="0,0,0,8"
                                         Style="{StaticResource AccentProgressBarStyle}"/>
                            <TextBlock Text="{Binding RamText}" Style="{StaticResource SmallTextStyle}"/>
                        </StackPanel>
                    </Border>

                    <!-- Disk -->
                    <Border Style="{StaticResource CardStyle}" Margin="8,0,0,0">
                        <StackPanel>
                            <Grid Margin="0,0,0,12">
                                <TextBlock Text="Disk" Style="{StaticResource SectionTitleStyle}"/>
                                <TextBlock Text="{Binding DiskUsage, Converter={StaticResource PctConv}}"
                                           HorizontalAlignment="Right" FontSize="20" FontWeight="Bold"
                                           Foreground="{Binding DiskUsage, Converter={StaticResource PctColorConv}}"/>
                            </Grid>
                            <ProgressBar Value="{Binding DiskUsage}" Maximum="100" Height="8" Margin="0,0,0,8"
                                         Style="{StaticResource AccentProgressBarStyle}"/>
                            <TextBlock Text="{Binding OsVersion}" Style="{StaticResource SmallTextStyle}" TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>
            </Grid>

            <!-- â•â•â• RECOMMENDED ACTIONS â•â•â• -->
            <TextBlock Text="{Binding RecommendedText}" Style="{StaticResource SectionTitleStyle}" Margin="0,0,0,12"/>
            <ItemsControl ItemsSource="{Binding RecommendedActions}" Margin="0,0,0,20">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,6" Padding="14" CornerRadius="8">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
                                    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsFixed}" Value="True">
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="36"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Icon -->
                                <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="20"
                                           VerticalAlignment="Center"/>

                                <!-- Info -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Title}" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="{Binding Description}" FontSize="11"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               TextWrapping="Wrap" MaxWidth="450"/>
                                </StackPanel>

                                <!-- Severity Badge -->
                                <Border Grid.Column="2" CornerRadius="4" Padding="8,3" Margin="8,0"
                                        VerticalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#2000B894"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                    <Setter Property="Background" Value="#20FDCB6E"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                    <Setter Property="Background" Value="#20FF6B6B"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding Severity}" FontSize="10" FontWeight="SemiBold">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                        <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                        <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>

                                <!-- Fix Button -->
                                <Button Grid.Column="3" Content="{Binding ActionLabel}"
                                        Height="30" MinWidth="80" FontSize="11"
                                        Command="{Binding DataContext.ApplyRecommendationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsFixed}" Value="True">
                                                    <Setter Property="Content" Value="âœ…"/>
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- QUICK ACTIONS ROW -->
            <TextBlock Text="{Binding QuickActionsText}" Style="{StaticResource SectionTitleStyle}" Margin="0,0,0,12"/>
            <UniformGrid Columns="4" Margin="0,0,0,20">
                <Border Style="{StaticResource CardStyle}" Margin="0,0,8,0" Cursor="Hand"
                        MouseLeftButtonDown="BoostRam_Click">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ðŸš€" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding BoostRamText}" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding BoostRamDesc}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardStyle}" Margin="4,0,4,0" Cursor="Hand"
                        MouseLeftButtonDown="GameMode_Click">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ðŸŽ®" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding GameModeText}" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding GameModeDesc}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardStyle}" Margin="4,0,4,0" Cursor="Hand"
                        MouseLeftButtonDown="NetworkReset_Click">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ðŸŒ" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding NetworkResetText}" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding NetworkResetDesc}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardStyle}" Margin="8,0,0,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ’»" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="GPU" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding GpuName}" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="140"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- TOP PROCESSES -->
            <TextBlock Text="{Binding TopProcessesText}" Style="{StaticResource SectionTitleStyle}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,20">
                <StackPanel>
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="80"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="PID" Style="{StaticResource SmallTextStyle}" FontWeight="SemiBold"/>
                        <TextBlock Grid.Column="1" Text="{Binding DataContext.EndText, RelativeSource={RelativeSource AncestorType=UserControl}, FallbackValue=Name}"
                                   Style="{StaticResource SmallTextStyle}" FontWeight="SemiBold"/>
                        <TextBlock Grid.Column="2" Text="MB" Style="{StaticResource SmallTextStyle}" FontWeight="SemiBold"/>
                        <TextBlock Grid.Column="3" Text="Status" Style="{StaticResource SmallTextStyle}" FontWeight="SemiBold"/>
                        <TextBlock Grid.Column="4" Text="" Style="{StaticResource SmallTextStyle}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    </Grid>
                    <Border Height="1" Background="{StaticResource BorderBrush}" Margin="0,0,0,4"/>

                    <ItemsControl ItemsSource="{Binding TopProcesses}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Pid}" Foreground="{StaticResource TextSecondaryBrush}"
                                               FontFamily="{StaticResource MonoFont}" FontSize="12" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Name}" Foreground="{StaticResource TextPrimaryBrush}"
                                               FontSize="12" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Grid.Column="2" Foreground="{StaticResource SecondaryAccentBrush}"
                                               FontFamily="{StaticResource MonoFont}" FontSize="12" VerticalAlignment="Center">
                                        <TextBlock.Text>
                                            <Binding Path="MemoryMB" StringFormat="{}{0} MB"/>
                                        </TextBlock.Text>
                                    </TextBlock>
                                    <TextBlock Grid.Column="3" Text="{Binding Status}" FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                    <Button Grid.Column="4" Content="âŒ" Style="{StaticResource DangerButtonStyle}"
                                            Height="26" MinWidth="50" FontSize="11"
                                            Command="{Binding DataContext.KillProcessCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding Pid}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
